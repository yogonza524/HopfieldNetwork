<!doctype html>
<html>
<head>
	<title>Hopfield Network</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/foundation.min.css" />
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

</head>
<body>
	<div class="jumbotron">
	  <div class="container">
	  	Gonzalo H. Mendoza<br />yogonza524@gmail.com <br /><a href="http:\\idsoft.com.ar">Div-ID Software</a>
	  	<br /> <a href="http://stackoverflow.com/users/5079517/gonzalo-mendoza">Stackoverflow</a><br />
	  	<a href="https://www.youtube.com/channel/UCmTo3RyFzlcox7lx0CVl3ww">Youtube Chanel</a>
	  	<h1>Hopfield Network</h1>
		  <p>Greetings, I have the pleasure to present an implementation useful for the study of neural networks</p>
		  <p>
		  		The work is a Java implementation on a network of discrete type Hopield
		  </p>
		  <div class="btn-group" role="group" aria-label="...">
			  <a href="https://github.com/yogonza524/HopfieldNetwork/releases/download/1.0/Hopfield-1.0.jar" class="btn btn-default">Download Library source</a>
			  <a href="https://github.com/yogonza524/HopfieldNetwork/releases/download/1.0.1/HopfieldFX-1.0.jar" class="btn btn-default">Download GUI application</a>
			  <a href="https://github.com/yogonza524/HopfieldNetwork" class="btn btn-default">View on GitHub</a>
		  </div>
		  <ul class="nav nav-pills">
			  <li role="presentation"><a href="#import">I want to import to my own project</a></li>
			  <li role="presentation"><a href="#classes">Show me the classes</a></li>
			  <li role="presentation"><a href="#lunch">How to lunch</a></li>
			  <li role="presentation"><a href="#test">Show me a test</a></li>
			  <li role="presentation"><a href="ModelodeHopfield.pdf">Show me a practical problem</a></li>
			</ul>
	  </div>
	</div>
	<div class="container">
		<h2>The model</h2>
		<p>
			A Hopfield network is a form of recurrent artificial neural network popularized by John Hopfield in 1982, but described earlier by Little in 1974. Hopfield nets serve as content-addressable memory systems with binary threshold nodes. They are guaranteed to converge to a local minimum, but convergence to a false pattern (wrong local minimum) rather than the stored pattern (expected local minimum) can occur. Hopfield networks also provide a model for understanding human memory. More info in <a href="https://en.wikipedia.org/wiki/Hopfield_network">Hopfield Network in Wikipedia</a>
		</p>
		<img src="img/patterns.jpg" class="img-responsive">
		<h2>About the project</h2>
		<p>
			The source code was developed under the Java version 7. Development platform is Microsoft Windows 7 Professional Edition and NetBeans IDE 8.1 was used for development. Maven is used to manage the lifecycle of the project and versions
		</p>
		<h2>Project structure</h2>
		<div class="row">
			<div class="col-sm-12 col-md-6 col-lg-4">
				<img src="img/a.png" class="img-responsive" />
			</div>
			<div class="col-sm-12 col-md-6 col-lg-8">
				<p>
					The core package has the next classes
				</p>
				<ul>
					<li>
						<a href="#hopfield">Hopfield</a>: core class, implements the methods necessary for training and recognition of an input pattern distorted or known
					</li>
					<li>
						<a href="#ifunction">IFunction</a>: interface that defines the required method for calculating the activation function
					</li>
					<li>
						<a href="#matrix">Matrix</a>: class needed to implement the matrix logic operations as well also between them and the vectors
					</li>
					<li>
						<a href="#stepfunction">StepFunction</a>: iFunction class that implements the interface for a step function (-1 to 1)
					</li>
				</ul>
			</div>
		</div>
		<!-- <pre>
			<code class="java">
	//Create the patterns examples for training
	double[] pattern1 = new double[]{1.0, -1.0,1.0,-1.0,1.0,-1.0,1.0,-1.0,1.0};
	double[] pattern2 = new double[]{1.0, 1.0,1.0,-1.0,1.0,-1.0,-1.0,1.0,-1.0};
			</code>
		</pre> -->
		<h2 id="import">Import to your project</h2>
		<p>
			If you want to include the library in your Java project you can do so via Maven. Define the repository comfortably Jitpack to download the library from GitHub to your project. Then add the dependency as shown in the example
		</p>
		<pre>
			<code id="xml">
&lt;repository&gt;
      &lt;id>jitpack.io&lt;/id&gt;
      &lt;url>https://jitpack.io&lt;/url&gt;
&lt;/repository&gt;
&lt;dependency&gt;
      &lt;groupId&gt;com.github.yogonza524&lt;/groupId&gt;
      &lt;artifactId&gt;HopfieldNetwork&lt;/artifactId&gt;
      &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
			</code>
		</pre>
		<h2 id="lunch">How to lunch the application</h2>
		<p>
			If you decide to download the application with graphical environment (GUI ) you need to have installed the Java virtual machine . You can install it for your platform in <a href="http://www.oracle.com/technetwork/es/java/javase/downloads/jre7-downloads-1880261.html">Oracle Java Runtime Edition 7 page</a>
		</p>
		<h2 id="test">JUnit Test</h2>
		<p>
			Here we have a JUnit test, first we train the Hopfield network and after we test a pattern
		</p>
		<pre>
			<code id="java">
 @Test
 public void hopfieldTest(){
     double[] p1 = new double[]{1.0, -1.0,1.0,-1.0,1.0,-1.0,1.0,-1.0,1.0}; //for training
     double[] p2 = new double[]{1.0, 1.0,1.0,-1.0,1.0,-1.0,-1.0,1.0,-1.0}; //for training

     double[] p3 = new double[]{1.0, 1.0,-1.0,-1.0,1.0,-1.0,-1.0,1.0,-1.0}; //for test
     
     ArrayList<double[]> patterns = new ArrayList<>();
     patterns.add(p1);
     patterns.add(p2);
     
     Hopfield h = new Hopfield(9, new StepFunction());
     h.train(patterns); //train with 2 patterns
     double[] result = h.test(p3);
     System.out.println("\nConnections of Network: " + h.connections() + "\n");
     System.out.println("Good recuperation capacity of samples: " 
     	+ Hopfield.goodRecuperation(h.getWeights().length) + "\n");
     System.out.println("Perfect recuperation capacity of samples: " 
     	+ Hopfield.perfectRacuperation(h.getWeights().length) + "\n");
     System.out.println("Energy: " + h.energy(result));
     Matrix.showMatrix(h.getWeights()); //show the Weight matrix
     System.out.println("\nPattern result of test");
     Matrix.showVector(result); //show the result, if the pattern was not recognized then every value is equals to NaN
    
     h.showAuxVector(); //Show the loop vector
 }
			</code>
		</pre>
		After run the test we have the next results
		<pre>
			<code>
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running HopfieldTest

Connections of Network: 72

Good recuperation capacity of samples: 1

Perfect recuperation capacity of samples: 1

Energy: -32.0
 0.0	   0.0	    2.0	   -2.0	   2.0	   -2.0	    0.0	    0.0	    0.0
 0.0	   0.0	    0.0	    0.0	   0.0	    0.0	   -2.0	    2.0	   -2.0
 2.0	   0.0	    0.0	   -2.0	   2.0	   -2.0	    0.0	    0.0	    0.0
-2.0       0.0	   -2.0	    0.0   -2.0	    2.0	    0.0	    0.0	    0.0
 2.0	   0.0	    2.0	   -2.0	   0.0	   -2.0	    0.0	    0.0	    0.0
-2.0       0.0	   -2.0	    2.0	  -2.0	    0.0	    0.0	    0.0	    0.0
 0.0	  -2.0	    0.0	    0.0	   0.0	    0.0	    0.0	   -2.0	    2.0
 0.0	   2.0	    0.0	    0.0	   0.0	    0.0	   -2.0	    0.0	   -2.0
 0.0	  -2.0	    0.0	    0.0	   0.0	    0.0	    2.0	   -2.0	    0.0

Pattern result of test
1.0	1.0	1.0	-1.0	1.0	-1.0	-1.0	1.0	-1.0
-------------------------
The auxiliar vector is empty

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.113 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

------------------------------------------------------------------------
BUILD SUCCESS
------------------------------------------------------------------------
Total time: 2.344s
			</code>
		</pre>
		<h2 id="classes">Classes</h2>
		<p>Here we have all classes used in the library</p>
		<h3 id="hopfield">Hopfield</h3>
		<pre>
			<code class="java">
package com.core.hopfield;

import java.util.ArrayList;
import java.util.Iterator;

/**
 *
 * @author Gonza
 */
public class Hopfield {
    
    private double[][] W;
    private final IFunction f;
    private ArrayList<double[]> patterns;
    private ArrayList<double[]> aux;

    public ArrayList<double[]> getAux() {
        return aux;
    }

    public ArrayList<double[]> getPatterns() {
        return patterns;
    }
    
    public Hopfield(int neurons, IFunction function) {
            this.f = function;
            this.W = new double[neurons][neurons];
            initW();
    }
    
    private void initW(){
        for (int i = 0; i < W.length; i++) {
            for (int j = 0; j < W.length; j++) {
                this.W[i][j] = 0.0;
            }
        }
    }
    
    public void train(ArrayList<double[]> patterns){
        this.patterns = patterns;
        Iterator<double[]> i = patterns.iterator();
        while(i.hasNext()){
            if (i.next().length != this.W.length) {
                throw new IndexOutOfBoundsException("All patterns must have " + this.W.length + " dimensions");
            }
        }
        i = patterns.iterator();
        while(i.hasNext()){
            double[] v = i.next();
            double[][] wAux = Matrix.subtract(Matrix.multiply(v, v), Matrix.identity(this.W.length));
            this.W = Matrix.add(W, wAux);
        }
    }
    
    public double[] test(double[] pattern){
        boolean found = false;
        boolean loop = false;
        if (pattern.length != this.W.length) {
            throw new IndexOutOfBoundsException("The pattern doesn't have " + this.W.length + " dimensions");
        }
        double[] result = pattern;
        aux = new ArrayList<>();
        while(!found && !loop){
            result = f.calculate(Matrix.multiply(W, result));
            if (!this.contains(result, patterns)) {
                //The result wasn't in the pattern list
                if (!this.contains(result, aux)) {
                    //There are not loops
                    aux.add(result);
                }
                else{
                    loop = true; //loop found, result exists in aux list
                }
            }
            else{
                found = true; //pattern equals result, found in patterns list
            }
        }
        if (!found) {
            for (int i = 0; i < pattern.length; i++) {
                result[i] = Double.NaN;
            }
        }
        return result;
    }
    
    public double energy(double[] patterns){
        double[] result = this.test(patterns);
        double energy = Double.MIN_VALUE;
        for (int i = 0; i < result.length; i++) {
            if (result[i] == Double.NaN) {
                break;
            }
        }
        for (int i = 0; i < this.W.length; i++) {
            for (int j = 0; j < this.W.length; j++) {
                energy += -0.5 * this.W[i][j] * result[i] * result[j];
            }
        }
        return energy;
    }
    
    private boolean contains(double[] pattern, ArrayList<double[]> patterns){
        boolean output = false;
        for (int i = 0; i < patterns.size(); i++) {
             if (Matrix.equals(pattern, patterns.get(i))) {
                 output = true;
                 break;
             }
         }
        return output;
    }
    
    public void showWeights(){
        Matrix.showMatrix(W);
    }
    
    public double[][] getWeights(){
        return this.W;
    }
    
    public void showAuxVector(){
        System.out.println("-------------------------");
        if (!this.aux.isEmpty()) {
            System.out.println("Auxiliar vector for loop inside the test");
            for (int i = 0; i < aux.size(); i++) {
                System.out.println("Iteration " + i);
                Matrix.showVector(aux.get(i));
            }
        }
        else{
            System.out.println("The auxiliar vector is empty");
        }
    }
    
    public String getAuxVector(){
        String result = "-------------------------\n";
        if (this.aux != null &&!this.aux.isEmpty()) {
            result += "Auxiliar vector for loop inside the test\n";
            for (int i = 0; i < aux.size(); i++) {
                result += "Iteration " + i + ": \t";
                result += Matrix.getVector(aux.get(i)) + "\n";
            }
        }
        else{
            result += "The auxiliar vector is empty";
        }
        return result;
    }
    
    public static int goodRecuperation(int neurons){
        return (int)(0.138 * neurons);
    }
    
    public static int perfectRacuperation(int neurons){
        return (int)(neurons / (4 * Math.log(neurons)));
    }
    
    public int connections(){
        return this.W.length * (this.W.length - 1);
    }
}

			</code>
		</pre>
		<h2 id="ifunction">IFunction</h2>
		<pre>
			<code id="java">
package com.core.hopfield;

/**
 *
 * @author Gonza
 */
public interface IFunction {
    
    public double[] calculate(double[] net);
}

			</code>
		</pre>
		<h2 id="matrix">Matrix</h2>
		<pre>
			<code class="java">
package com.core.hopfield;

/**
 *
 * @author Gonza
 */
public class Matrix {
    
    // return a random m-by-n matrix with values between 0 and 1
    public static double[][] random(int m, int n) {
        double[][] C = new double[m][n];
        for (int i = 0; i < m; i++)
            for (int j = 0; j < n; j++)
                C[i][j] = Math.random();
        return C;
    }

    // return n-by-n identity matrix I
    public static double[][] identity(int n) {
        double[][] I = new double[n][n];
        for (int i = 0; i < n; i++)
            I[i][i] = 1;
        return I;
    }

    // return x^T y
    public static double dot(double[] x, double[] y) {
        if (x.length != y.length) throw new RuntimeException("Illegal vector dimensions.");
        double sum = 0.0;
        for (int i = 0; i < x.length; i++)
            sum += x[i] * y[i];
        return sum;
    }

    // return C = A^T
    public static double[][] transpose(double[][] A) {
        int m = A.length;
        int n = A[0].length;
        double[][] C = new double[n][m];
        for (int i = 0; i < m; i++)
            for (int j = 0; j < n; j++)
                C[j][i] = A[i][j];
        return C;
    }

    // return C = A + B
    public static double[][] add(double[][] A, double[][] B) {
        int m = A.length;
        int n = A[0].length;
        double[][] C = new double[m][n];
        for (int i = 0; i < m; i++)
            for (int j = 0; j < n; j++)
                C[i][j] = A[i][j] + B[i][j];
        return C;
    }

    // return C = A - B
    public static double[][] subtract(double[][] A, double[][] B) {
        int m = A.length;
        int n = A[0].length;
        double[][] C = new double[m][n];
        for (int i = 0; i < m; i++)
            for (int j = 0; j < n; j++)
                C[i][j] = A[i][j] - B[i][j];
        return C;
    }

    // return C = A * B
    public static double[][] multiply(double[][] A, double[][] B) {
        int mA = A.length;
        int nA = A[0].length;
        int mB = B.length;
        int nB = B[0].length;
        if (nA != mB) throw new RuntimeException("Illegal matrix dimensions.");
        double[][] C = new double[mA][nB];
        for (int i = 0; i < mA; i++)
            for (int j = 0; j < nB; j++)
                for (int k = 0; k < nA; k++)
                    C[i][j] += A[i][k] * B[k][j];
        return C;
    }

    // matrix-vector multiplication (y = A * x)
    public static double[] multiply(double[][] A, double[] x) {
        int m = A.length;
        int n = A[0].length;
        if (x.length != n) throw new RuntimeException("Illegal matrix dimensions.");
        double[] y = new double[m];
        for (int i = 0; i < m; i++)
            for (int j = 0; j < n; j++)
                y[i] += A[i][j] * x[j];
        return y;
    }


    // vector-matrix multiplication (y = x^T A)
    public static double[] multiply(double[] x, double[][] A) {
        int m = A.length;
        int n = A[0].length;
        if (x.length != m) throw new RuntimeException("Illegal matrix dimensions.");
        double[] y = new double[n];
        for (int j = 0; j < n; j++)
            for (int i = 0; i < m; i++)
                y[j] += A[i][j] * x[i];
        return y;
    }
    
    //vector-vector multiplication (S = a * b)
    public static double[][] multiply(double[] column, double[] row){
        int columns = column.length;
        int rows = row.length;
        double[][] output = new double[columns][rows];
        for (int i = 0; i < rows; i++) {
            for (int j = 0; j < columns; j++) {
                output[i][j] = column[i] * row[j];
            }
        }
        return output;
    }
    
    //show all vector components
    public static void showVector(double[] values){
        for (int i = 0; i < values.length - 1; i++) {
            System.out.print(values[i] + "\t");
        }
        System.out.println(values[values.length - 1]);
    }
    
    //show all matrix components
    public static void showMatrix(double[][] values){
        for (int i = 0; i < values.length; i++) {
            showVector(values[i]);
        }
    }
    
    public static String getVector(double[] values){
        String result = "";
         for (int i = 0; i < values.length - 1; i++) {
            result += values[i] + "\t\t";
        }
         result += values[values.length - 1];
        return result;
    }
    
    public static String getMatrix(double[][] values){
        String result = "";
         for (int i = 0; i < values.length; i++) {
            result += Matrix.getVector(values[i]) + "\n";
        }
        return result;
    }
    
    public static boolean equals(double[] a, double[] b){
        if (a == null) {
            throw new NullPointerException("first vector is null");
        }
        if (b == null) {
            throw new NullPointerException("second vector is null");
        }
        if (a.length != b.length) {
            throw new NullPointerException("Both vectors have differents dimensions");
        }
        boolean result = true;
        for (int i = 0; i < a.length; i++) {
            if (a[i] != b[i]) {
                result = false;
                break;
            }
        }
        return result;
    }
}
			</code>
		</pre>
		<h2 id="stepfunction">StepFunction</h2>
		<pre>
			<code id="java">
package com.core.hopfield;

/**
 *
 * @author Gonza
 */
public class StepFunction implements IFunction{

    /**
     * Return an array pattern for a single array
     * @param net value to evaluate
     * @return an array with 1 if net >= 0 or (exclusive) -1 if net < 0
     */
    @Override
    public double[] calculate(double[] net) {
        double[] output = new double[net.length];
        for (int i = 0; i < net.length; i++) {
            output[i] = net[i] >= 0? 1.0 : -1.0;
        }
        return output;
    }
    
}

			</code>
		</pre>
		<h2>Comment what you think</h2>
		<div id="fb-root"></div>
		<div class="fb-comments" data-href="http://yogonza524.github.io/HopfieldNetwork/" data-numposts="20"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.6&appId=473188122705245";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script>
	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-79359022-1', 'auto');
	  ga('send', 'pageview');

	</script>
</body>
</html>